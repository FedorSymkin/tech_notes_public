# Примеры TCP / UDP сервера / клиента

Источник: 
http://masandilov.ru/network/guide_to_network_programming

* TCP-сервер
    * Готовим структуру с данными по тику сокета и адресу (сишная муть)
    * Создаём сокет (вызов socket)
    * Делаем ему bind на нужный ip/port, где слушать
    * Говорим ему listen - начать слушать
    * Вызываем для него accept и засыпаем в ожидании клиента
    * accept вернёт **новый** - пользовательский - сокет, и через этот новый уже будет обмен данными
    * Исходный - "слушающий" - сокет опять отправляем в accept
    * Что дальше делать с новым сокетом, который вернула accept - на усмотрение разработчика.
    * Важно: если пользовательский сокет отправляет данные, а на той стороне сервер их не принял, будет ошибка, потому что TCP
    * Когда надоело, слушающий сокет
    
* TCP-клиент
    * Готовим структуру с данными по тику сокета и адресу (сишная муть)
    * Создаём сокет (вызов socket)
    * Говорим ему connect на указанный ip/port
    * Отправляем / читаем данные
    * Когда надоело, закрываем сокет

* UDP читатель
    * Готовим структуру с данными по тику сокета и адресу (сишная муть)
    * Создаём сокет (вызов socket)
    * Делаем ему bind на нужный ip/port, где слушать
    * Далее никаких listen и accept - просто читаем из этого же сокета через немного другой системный вызов recvfrom
    * recvfrom вернёт не только данные, но и адрес откуда пришло
    * Когда надоело, закрываем сокет
    
* UDP писатель
    * Готовим структуру с данными по тику сокета и адресу (сишная муть)
    * Создаём сокет (вызов socket)
    * Отправляем данные, но не через send, а через sendto, и сразу же туда передаём адрес куда отправлять
    * Важно: если пользовательский сокет отправляет данные, а на той стороне сервер их не принял, **не** будет ошибки, потому что UDP
    
* Ещё тонкости
    * При отправке данных как по TCP, так и по UDP не гарантируется, что все данные будут отправлены. Надо  следить за возврщаемым значением send / sendto и доотправлять остаток, если надо.
    * Для упаковки простых интов и прочих примитивных данных в сетевой формат (BigEndian) есть функции htons, htonl, ..., google it
    * Примеры сделаны в виде google test. Сразу всё лучше не запускать, лучше запускать по одному, например:
    ```
    ./launch.sh network.simple_tcp_server_multithread_readline
    ```
